const fs = require('fs');
let webapp = require('./webapp.js');
let ServeFile = require('./lib/models/serveFile.js');
let serveFile = new ServeFile('public',fs).getRequestHandler();
const lib = require('./lib/handlers.js');
let app = webapp.create();
app.use(lib.loadUser);
app.use(lib.redirectLoggedOutUserToLogin);
app.use(lib.redirectLoggedInUserToHome);
app.post('/changeStatus',lib.statusHandler);
app.post('/deleteTodoItem',lib.deleteTodoItem);
app.post('/login',lib.loginHandler);
app.get('/logout',lib.logoutHandle);
app.post('/addTodo',lib.addTodoHandler);
app.post('/getAllTitle',lib.getAllTitle);
app.post('/deleteTodo',lib.deleteTodoHandler);
app.post('/getTodoItems',lib.todoItemsHandler);
app.post('/addTodoItem',lib.addTodoItemHandler);
app.postProcess(serveFile);
app.postProcess(lib.serveTodo);
module.exports = app;
